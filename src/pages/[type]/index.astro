---
import Layout from "../../layouts/Layout.astro";
import { DATA_TYPES, DISTRICTS, type DataTypeId } from "../../utils/caltrans";
import { COUNTIES, ROUTES } from "../../data/locations";
import DistrictSelector from "../../components/DistrictSelector";

export const prerender = true;
Astro.response.headers.set("Cache-Control", "public, max-age=86400");

const { type } = Astro.params;
const dataType = DATA_TYPES[type as DataTypeId];

if (!dataType) {
  return Astro.redirect("/404");
}

const availableDistricts = DISTRICTS.filter((d) =>
  (dataType.districts as readonly string[]).includes(d.id),
);

export function getStaticPaths() {
  // Return a static path for each data type key (e.g. /cctv, /cc, /cms)
  return Object.keys(DATA_TYPES).map((typeKey) => ({params: {type: typeKey}}));
}

---

<Layout title={`${dataType.name} - Caltrans Explorer`}>
  <div class="mb-8">
    <a
      href="/"
      class="text-black hover:underline transition-colors mb-4 inline-block"
      >&larr; Back to Dashboard</a
    >
    <h1 class="text-4xl font-bold text-black mb-2">
      {dataType.name}
    </h1>
    <p class="text-gray-600">
      Select how you want to find ${dataType.name}
    </p>
  </div>

  <DistrictSelector
    client:load
    type={type as string}
    districts={availableDistricts}
    counties={COUNTIES}
    routes={ROUTES}
  />

  <div class="mt-20 prose prose-slate max-w-none">
    <h2 class="text-xl font-bold mb-3">Find {dataType.name} in California</h2>
    <p>
      Use the filters above to locate <strong
        >{dataType.name.toLowerCase()}</strong
      > by:
    </p>
    <ul class="list-disc pl-5">
      <li>
        <strong>County:</strong> Select from all 58 California counties (e.g., Alameda,
        Los Angeles, Placer).
      </li>
      <li>
        <strong>Route:</strong> Browse by major Interstate (I-5, I-80), State Route
        (SR-1), or US Highway.
      </li>
      <li>
        <strong>District:</strong> View regional data by Caltrans administrative
        district.
      </li>
    </ul>
    <p class="text-sm text-gray-500 mt-4">
      All data is updated in real-time. {dataType.name} information is crucial for
      safe navigation during winter storms, rush hour traffic, and road construction
      projects.
    </p>
  </div>
</Layout>
